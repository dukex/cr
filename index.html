<!DOCTYPE html>
<html>
  <head>
    <title>Hello World!</title>
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style media="screen">
      /*pre, code{
        font-family: 'Droid Sans Mono';
      }
      li {
        padding: 5px 10px;
        height: 30px;
        line-height: 2
      }
      li.reviewed {
        opacity: 0.6;
        text-decoration: line-through;
      }
      li.reviewed::before{
        content: "done";
        color: green;
        font-family: 'Material Icons';
        text-rendering: optimizeLegibility;
        font-feature-settings: "liga" 1;
        font-style: normal;
        text-transform: none;
        line-height: 1;
        display: inline-block;
        overflow: hidden;
        -webkit-font-smoothing: antialiased;
      }

      button.reviewed, button.review, button.unreview {
        border: 1px solid green;
        background-color: #FFF;
        color: rgb(48, 134, 5);
        border-radius: 5px;
        margin: 0 5px;
      }

      button.review {
        border: 1px solid blue;
        color: rgb(22, 60, 134);
      }

      button.unreview {
        border: 1px solid red;
        color: rgb(134, 13, 22);
      }

      li.reviewed button.reviewed, li.reviewed button.review {
        display: none
      }

      button.unreview {
        display: none;
      }

      li.reviewed button.unreview {
        display: inline-block;
      }

      ul#commits {
        list-style: none;
        margin: 0;
        padding: 0;
        font-size: 18px;
        font-family: 'Droid Sans Mono';
      }
      ul#commits b {
        padding: 0 10px 0 0;
      }
      ul#commits span.author {
        color: darkblue;
        font-size: 16px;
      }

      ul#commits span.date {
        color: red;
        font-size: 16px;
      }*/
    </style>
    <link rel="stylesheet" href="./node_modules/highlight.js/styles/monokai_sublime.css" media="screen" title="no title" charset="utf-8">
  </head>
  <body>
    <div id="app">
    </div>

    <script id="commits-template" type="text/x-handlebars-template">
      <ul id="commits">
        {{#each commits}}
          <li id="commit-{{sha}}">
            <b>{{sha_short}}</b>
            <span class="author">{{author}}</span>
            -
            {{message}}
            <span class="date">{{date}}</span>

            <button>Mark as reviewed</button>
            <button onclick="App.reviewFn('{{sha}}')">Review</button>
          </li>
        {{/each}}
      </ul>
    </script>

    <script id="commit-template" type="text/x-handlebars-template">
      <button onclick="App.commitsFn()">Voltar</button>
      {{commit.sha}}
    </script>

    <script type="text/javascript">
      window.RSVP = require('./assets/rsvp.js');
      window.RouteRecognizer = require('./assets/route-recognizer.js');
    </script>

    <script src="assets/handlebars.js" charset="utf-8"></script>
    <script src="assets/router.js" charset="utf-8"></script>
    <script src="assets/app.js" charset="utf-8"></script>

    <script type="text/javascript">
      var moment = require('moment');
      var h = require('highlight.js');
      h.configure({useBR: true});

      var Firebase = require("firebase");
      var ref = new Firebase("https://intense-torch-1886.firebaseio.com/reviewed");
      var ipc = require('ipc');

      ipc.on('open', function(data) {
        var directory = data[0];
        startApp("#app", directory);

        // var authData = ref.getAuth();

        // openRepository(directory, authData);
      });
      // var showHistory = function(d) {
      //   var reviewed = d[0];
      //   var firstCommitOnMaster = d[1];
      //   var history = firstCommitOnMaster.history();
      //   history.on('commit', function(commit) {
      //     var author = commit.author();
      //     var li = document.createElement('li');
      //     var b = document.createElement("b");
      //     var authorEl = document.createElement("span");
      //     var dateEl = document.createElement("span");
      //     var reviewedEl = document.createElement('button');
      //     var reviewEl = document.createElement('button');
      //     var unreviewEl = document.createElement('button');
      //
      //     authorEl.classList.add("author");
      //     dateEl.appendChild(document.createTextNode(" "));
      //     dateEl.classList.add("date");
      //     reviewedEl.appendChild(document.createTextNode("thumb_up"));
      //     reviewedEl.classList.add("material-icons");
      //     reviewedEl.classList.add("reviewed");
      //     reviewEl.appendChild(document.createTextNode("search"));
      //     reviewEl.classList.add("material-icons");
      //     reviewEl.classList.add('review');
      //     unreviewEl.appendChild(document.createTextNode("thumb_down"));
      //     unreviewEl.classList.add("material-icons");
      //     unreviewEl.classList.add('unreview');
      //
      //     reviewedEl.addEventListener('click', function (e) {
      //       reviewed.child(this.sha().slice(0, 6)).set({
      //         reviewed: true
      //       });
      //       e.preventDefault();
      //     }.bind(commit), false);
      //     reviewEl.addEventListener('click', function  (e) {
      //       return this.getDiff().then(function(diffList) {
      //         lines = [];
      //         diffList.forEach(function(diff) {
      //           diff.patches().forEach(function(patch) {
      //             lines.push("--- " +patch.oldFile().path());
      //             lines.push("+++ " +patch.newFile().path());
      //             patch.hunks().forEach(function(hunk) {
      //               lines.push(hunk.header());
      //               hunk.lines().forEach(function(line) {
      //                 lines.push(String.fromCharCode(line.origin()) + line.content());
      //               });
      //             });
      //           });
      //         });
      //         var diff = document.querySelector('#diff');
      //         diff.innerHTML = "<pre><code class='hljs'>" + h.highlight("diff", lines.join("\n")).value + "</code></pre>";
      //         window.scroll(0, 0)
      //       });
      //     }.bind(commit), false);
      //     commits.insertAdjacentElement('beforeend', li);
      //   });
      //
      //   history.start();
      //   reviewed.on("value", function (snapshot) {
      //     if(!snapshot.val()){
      //       return
      //     }
      //     var data = snapshot.val();
      //     Object.keys(data).forEach(function(sha){
      //       var commit = document.querySelector("#commit-" + sha);
      //       if(data[sha].reviewed) {
      //         commit && commit.classList.add('reviewed');
      //       }
      //     })
      //   })
      // };
      </script>
  </body>
</html>
